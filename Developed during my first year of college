import discord
from discord.ext import commands
from datetime import datetime

intents = discord.Intents.all()
intents.messages = True

bot = commands.Bot(command_prefix='!', intents=intents)

@bot.event
async def on_ready():
    print(f'Logged in as {bot.user.name}')

@bot.event
async def on_message(message):
    print(f'Message Content: "{message.content}"')
    print(f'Author: {message.author}')

    #Link detection
    if message.channel.id == [room number] and 'http' in message.content:
        # Automatic expulsion
        await message.delete()
        await message.author.kick(reason='링크 감지로 인한 추방')
    #Chat history
    if message.channel.id == [room number]:
        await log_message(message)
    
    #Link detection
    if message.channel.id == [room number]:
    # Excluding excessive input
        if len(message.content) > 300:
            await message.delete()
            await message.author.kick(reason='초과 입력으로 인한 추방')

    await bot.process_commands(message)

#log 
async def log_message(message):
    # create file 
    current_time = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
    file_name = f"log_{current_time}.txt"

    # Record the message
    with open(file_name, 'a', encoding='utf-8') as file:
        file.write(f'{message.author} ({message.author.id}): {message.content}\n')

bot.run(' ')
